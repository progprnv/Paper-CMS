{% extends "base.html" %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Welcome Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-gradient text-white border-0 shadow-lg">
                <div class="card-body p-4">
                    <div class="row align-items-center">
                        <div class="col-lg-8">
                            <h1 class="h3 fw-bold mb-1">
                                <i class="bi bi-speedometer2 me-2"></i>
                                Welcome back, {{ current_user.name }}!
                            </h1>
                            <p class="mb-0 opacity-75">
                                Here's an overview of your research activities and pending tasks.
                            </p>
                        </div>
                        <div class="col-lg-4 text-lg-end">
                            <div class="d-flex gap-2 justify-content-lg-end">
                                <a href="{{ url_for('main.submit_paper') }}" class="btn btn-warning">
                                    <i class="bi bi-plus-circle me-1"></i>Submit Paper
                                </a>
                                <a href="{{ url_for('main.browse_papers') }}" class="btn btn-outline-light">
                                    <i class="bi bi-search me-1"></i>Browse Papers
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistics Cards -->
    <div class="row g-4 mb-5">
        <div class="col-lg-3 col-md-6">
            <div class="dashboard-card primary card h-100">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col">
                            <h6 class="text-uppercase text-muted mb-2 fw-bold">Total Papers</h6>
                            <h2 class="mb-0 fw-bold">{{ stats.total_papers }}</h2>
                        </div>
                        <div class="col-auto">
                            <div class="icon bg-primary text-white rounded-circle p-3">
                                <i class="bi bi-file-text fs-4"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-3 col-md-6">
            <div class="dashboard-card success card h-100">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col">
                            <h6 class="text-uppercase text-muted mb-2 fw-bold">Accepted</h6>
                            <h2 class="mb-0 fw-bold">{{ stats.accepted }}</h2>
                        </div>
                        <div class="col-auto">
                            <div class="icon bg-success text-white rounded-circle p-3">
                                <i class="bi bi-check-circle fs-4"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-3 col-md-6">
            <div class="dashboard-card warning card h-100">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col">
                            <h6 class="text-uppercase text-muted mb-2 fw-bold">Under Review</h6>
                            <h2 class="mb-0 fw-bold">{{ stats.under_review }}</h2>
                        </div>
                        <div class="col-auto">
                            <div class="icon bg-warning text-white rounded-circle p-3">
                                <i class="bi bi-clock fs-4"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-3 col-md-6">
            <div class="dashboard-card info card h-100">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col">
                            <h6 class="text-uppercase text-muted mb-2 fw-bold">Rejected</h6>
                            <h2 class="mb-0 fw-bold">{{ stats.rejected }}</h2>
                        </div>
                        <div class="col-auto">
                            <div class="icon bg-danger text-white rounded-circle p-3">
                                <i class="bi bi-x-circle fs-4"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Papers & Quick Actions -->
    <div class="row g-4">
        <!-- Recent Papers -->
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-transparent border-bottom-0 pt-4 px-4 pb-0">
                    <div class="row align-items-center">
                        <div class="col">
                            <h5 class="card-title mb-0">
                                <i class="bi bi-file-text me-2 text-primary"></i>Your Recent Papers
                            </h5>
                        </div>
                        <div class="col-auto">
                            <a href="{{ url_for('main.browse_papers') }}" class="btn btn-sm btn-outline-primary">
                                View All <i class="bi bi-arrow-right ms-1"></i>
                            </a>
                        </div>
                    </div>
                </div>
                <div class="card-body p-4">
                    {% if papers %}
                        <div class="table-responsive">
                            <table class="table table-hover align-middle">
                                <thead class="table-light">
                                    <tr>
                                        <th>Title</th>
                                        <th>Status</th>
                                        <th>Conference</th>
                                        <th>Submitted</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for paper in papers[:5] %}
                                    <tr>
                                        <td>
                                            <div class="fw-semibold">{{ paper.title[:40] }}{% if paper.title|length > 40 %}...{% endif %}</div>
                                            <small class="text-muted">{{ paper.authors|length }} author{{ 's' if paper.authors|length != 1 else '' }}</small>
                                        </td>
                                        <td>
                                            <span class="badge {{ paper.status.name | status_badge }}">
                                                <span class="status-indicator status-{{ paper.status.name.lower().replace('_', '-') }}"></span>
                                                {{ paper.status.name | replace('_', ' ') | title }}
                                            </span>
                                        </td>
                                        <td>
                                            <div class="fw-semibold">{{ paper.conference.name }}</div>
                                            <small class="text-muted">{{ paper.conference.year }}</small>
                                        </td>
                                        <td>
                                            <span class="text-muted">{{ paper.submission_date | datetime('%b %d, %Y') }}</span>
                                        </td>
                                        <td>
                                            <div class="btn-group btn-group-sm">
                                                <a href="{{ url_for('main.paper_detail', id=paper.id) }}" 
                                                   class="btn btn-outline-primary" 
                                                   data-bs-toggle="tooltip" 
                                                   title="View Details">
                                                    <i class="bi bi-eye"></i>
                                                </a>
                                                {% if paper.file_path %}
                                                <a href="{{ url_for('main.download_paper', paper_id=paper.id) }}" 
                                                   class="btn btn-outline-success"
                                                   data-bs-toggle="tooltip" 
                                                   title="Download PDF">
                                                    <i class="bi bi-download"></i>
                                                </a>
                                                {% endif %}
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="text-center py-5">
                            <i class="bi bi-file-plus display-4 text-muted mb-3"></i>
                            <h6 class="text-muted">No papers submitted yet</h6>
                            <p class="text-muted mb-4">Start your research journey by submitting your first paper.</p>
                            <a href="{{ url_for('main.submit_paper') }}" class="btn btn-primary">
                                <i class="bi bi-plus-circle me-2"></i>Submit Your First Paper
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Quick Actions & Profile -->
        <div class="col-lg-4">
            <!-- Quick Actions -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-transparent border-bottom-0 pt-4 px-4 pb-0">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-lightning me-2 text-warning"></i>Quick Actions
                    </h5>
                </div>
                <div class="card-body p-4">
                    <div class="d-grid gap-2">
                        <a href="{{ url_for('main.submit_paper') }}" class="btn btn-primary">
                            <i class="bi bi-plus-circle me-2"></i>Submit New Paper
                        </a>
                        <a href="{{ url_for('main.browse_papers') }}" class="btn btn-outline-primary">
                            <i class="bi bi-search me-2"></i>Browse Papers
                        </a>
                        <a href="{{ url_for('main.profile') }}" class="btn btn-outline-secondary">
                            <i class="bi bi-person me-2"></i>Update Profile
                        </a>
                    </div>
                </div>
            </div>

            <!-- Profile Summary -->
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-transparent border-bottom-0 pt-4 px-4 pb-0">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-person-circle me-2 text-info"></i>Profile Summary
                    </h5>
                </div>
                <div class="card-body p-4">
                    <div class="text-center mb-3">
                        <div class="avatar bg-primary text-white rounded-circle mx-auto mb-2 d-flex align-items-center justify-content-center" 
                             style="width: 60px; height: 60px; font-size: 1.5rem;">
                            {{ current_user.name[0].upper() }}
                        </div>
                        <h6 class="fw-bold mb-1">{{ current_user.name }}</h6>
                        <span class="badge {{ current_user.role.name | role_badge }}">{{ current_user.role.name }}</span>
                    </div>
                    
                    <ul class="list-unstyled mb-0">
                        <li class="d-flex justify-content-between py-2 border-bottom">
                            <span class="text-muted">Email:</span>
                            <span class="fw-semibold">{{ current_user.email }}</span>
                        </li>
                        <li class="d-flex justify-content-between py-2 border-bottom">
                            <span class="text-muted">Member Since:</span>
                            <span class="fw-semibold">{{ current_user.created_at | datetime('%b %Y') }}</span>
                        </li>
                        <li class="d-flex justify-content-between py-2">
                            <span class="text-muted">Last Login:</span>
                            <span class="fw-semibold">
                                {% if current_user.last_login %}
                                    {{ current_user.last_login | datetime('%b %d') }}
                                {% else %}
                                    First time
                                {% endif %}
                            </span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add fade-in animation to cards
    const cards = document.querySelectorAll('.card');
    cards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
            card.style.transition = 'all 0.5s ease';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 100);
    });
    
    // Update any deadline countdowns
    if (typeof PaperFlowCMS !== 'undefined') {
        PaperFlowCMS.updateDeadlineCountdowns();
    }
});
</script>
{% endblock %}
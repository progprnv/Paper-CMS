<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paper-CMS Database Setup</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            color: #2d3748;
            margin-bottom: 30px;
        }
        .step {
            background: #f8f9fa;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #4299e1;
            border-radius: 5px;
        }
        .sql-box {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            margin: 15px 0;
        }
        .button {
            background: #4299e1;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        .button:hover {
            background: #3182ce;
        }
        .success {
            color: #38a169;
            font-weight: bold;
        }
        .warning {
            color: #d69e2e;
            font-weight: bold;
        }
        .info {
            background: #e6fffa;
            border: 1px solid #81e6d9;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .url-link {
            color: #4299e1;
            text-decoration: none;
            font-weight: bold;
        }
        .url-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Paper-CMS Supabase Setup</h1>
            <p>Your database is ready to be configured!</p>
        </div>

        <div class="step">
            <h2>üéØ Your Project Details</h2>
            <p><strong>Supabase Project:</strong> xssqhifnabymmsvvybgx</p>
            <p><strong>Database URL:</strong> postgresql://postgres:Admin@123#Admin@db.xssqhifnabymmsvvybgx.supabase.co:5432/postgres</p>
            <p><strong>Supabase URL:</strong> https://xssqhifnabymmsvvybgx.supabase.co</p>
        </div>

        <div class="step">
            <h2>üìã Step 1: Run Database Setup SQL</h2>
            <p>Copy the SQL below and paste it into your Supabase SQL Editor:</p>
            <p><a href="https://supabase.com/dashboard/project/xssqhifnabymmsvvybgx/sql" target="_blank" class="url-link">
                üîó Open Supabase SQL Editor
            </a></p>
            
            <button class="button" onclick="copySQL()">üìã Copy SQL</button>
            
            <div class="sql-box" id="sqlContent">-- Paper-CMS Database Setup for Supabase PostgreSQL (Simplified Version)
-- Run this SQL in your Supabase SQL Editor
-- This version does not use Row Level Security for easier setup

-- Enable UUID extension
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- Create enum types
CREATE TYPE user_role AS ENUM ('AUTHOR', 'REVIEWER', 'ADMIN');
CREATE TYPE paper_status AS ENUM ('SUBMITTED', 'UNDER_REVIEW', 'REVIEWED', 'ACCEPTED', 'REJECTED', 'REVISION_REQUIRED');
CREATE TYPE review_recommendation AS ENUM ('ACCEPT', 'MINOR_REVISION', 'MAJOR_REVISION', 'REJECT');
CREATE TYPE conference_status AS ENUM ('ACTIVE', 'CLOSED', 'UPCOMING');

-- Users table
CREATE TABLE IF NOT EXISTS users (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(120) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    role user_role NOT NULL DEFAULT 'AUTHOR',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_login TIMESTAMP,
    is_active BOOLEAN DEFAULT TRUE
);

-- Categories table
CREATE TABLE IF NOT EXISTS categories (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) UNIQUE NOT NULL,
    description TEXT,
    color VARCHAR(7) DEFAULT '#007bff'
);

-- Conferences table
CREATE TABLE IF NOT EXISTS conferences (
    id SERIAL PRIMARY KEY,
    name VARCHAR(200) NOT NULL,
    year INTEGER NOT NULL,
    submission_deadline TIMESTAMP NOT NULL,
    review_deadline TIMESTAMP,
    notification_date TIMESTAMP,
    status conference_status NOT NULL DEFAULT 'UPCOMING',
    description TEXT,
    website VARCHAR(500),
    reviews_per_paper INTEGER DEFAULT 3
);

-- Papers table
CREATE TABLE IF NOT EXISTS papers (
    id SERIAL PRIMARY KEY,
    title VARCHAR(500) NOT NULL,
    abstract TEXT NOT NULL,
    status paper_status NOT NULL DEFAULT 'SUBMITTED',
    submission_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    file_path VARCHAR(500),
    conference_name VARCHAR(200) NOT NULL,
    keywords VARCHAR(500),
    submitted_by INTEGER NOT NULL REFERENCES users(id),
    last_updated TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Reviews table
CREATE TABLE IF NOT EXISTS reviews (
    id SERIAL PRIMARY KEY,
    paper_id INTEGER NOT NULL REFERENCES papers(id) ON DELETE CASCADE,
    reviewer_id INTEGER NOT NULL REFERENCES users(id),
    score INTEGER,
    comments TEXT,
    recommendation review_recommendation,
    review_date TIMESTAMP,
    assigned_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    deadline TIMESTAMP,
    is_completed BOOLEAN DEFAULT FALSE,
    technical_quality INTEGER,
    novelty INTEGER,
    clarity INTEGER,
    significance INTEGER
);

-- Affiliations table
CREATE TABLE IF NOT EXISTS affiliations (
    id SERIAL PRIMARY KEY,
    user_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    institution_name VARCHAR(200) NOT NULL,
    department VARCHAR(200),
    position VARCHAR(100),
    is_primary BOOLEAN DEFAULT FALSE
);

-- Paper-Authors junction table
CREATE TABLE IF NOT EXISTS paper_authors (
    paper_id INTEGER REFERENCES papers(id) ON DELETE CASCADE,
    user_id INTEGER REFERENCES users(id) ON DELETE CASCADE,
    PRIMARY KEY (paper_id, user_id)
);

-- Paper-Categories junction table
CREATE TABLE IF NOT EXISTS paper_categories (
    paper_id INTEGER REFERENCES papers(id) ON DELETE CASCADE,
    category_id INTEGER REFERENCES categories(id) ON DELETE CASCADE,
    PRIMARY KEY (paper_id, category_id)
);

-- Create indexes for better performance
CREATE INDEX IF NOT EXISTS idx_users_email ON users(email);
CREATE INDEX IF NOT EXISTS idx_users_role ON users(role);
CREATE INDEX IF NOT EXISTS idx_papers_status ON papers(status);
CREATE INDEX IF NOT EXISTS idx_papers_conference ON papers(conference_name);
CREATE INDEX IF NOT EXISTS idx_papers_submitted_by ON papers(submitted_by);
CREATE INDEX IF NOT EXISTS idx_reviews_paper ON reviews(paper_id);
CREATE INDEX IF NOT EXISTS idx_reviews_reviewer ON reviews(reviewer_id);
CREATE INDEX IF NOT EXISTS idx_reviews_completed ON reviews(is_completed);

-- Create trigger to update last_updated on papers
CREATE OR REPLACE FUNCTION update_last_updated()
RETURNS TRIGGER AS $$
BEGIN
    NEW.last_updated = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$ language 'plpgsql';

CREATE TRIGGER update_papers_last_updated
    BEFORE UPDATE ON papers
    FOR EACH ROW
    EXECUTE FUNCTION update_last_updated();

-- Insert default admin user (password: admin123)
-- You should change this password after first login
INSERT INTO users (name, email, password_hash, role) 
VALUES (
    'Administrator', 
    'admin@paper-cms.com', 
    'scrypt:32768:8:1$qJ8VWq8IjXlE1O0P$ae6c9f8b5c4d3e2f1a0b9c8d7e6f5a4b3c2d1e0f9a8b7c6d5e4f3a2b1c0d9e8f7a6b5c4d3e2f1a0b9c8d7e6f', 
    'ADMIN'
) ON CONFLICT (email) DO NOTHING;

-- Insert default categories
INSERT INTO categories (name, description, color) VALUES
    ('Computer Science', 'General computer science research', '#007bff'),
    ('Machine Learning', 'AI and ML research papers', '#28a745'),
    ('Data Science', 'Data analysis and statistics', '#ffc107'),
    ('Software Engineering', 'Software development research', '#dc3545'),
    ('Cybersecurity', 'Security and privacy research', '#6f42c1')
ON CONFLICT (name) DO NOTHING;

-- Create a sample conference
INSERT INTO conferences (name, year, submission_deadline, status, description, reviews_per_paper) VALUES
    ('International Conference on Academic Research', 2025, '2025-06-01 23:59:59', 'ACTIVE', 'Premier academic research conference', 3)
ON CONFLICT DO NOTHING;

COMMIT;</div>
        </div>

        <div class="step">
            <h2>üóÑÔ∏è Step 2: Create Storage Bucket</h2>
            <p>Create a storage bucket for file uploads:</p>
            <p><a href="https://supabase.com/dashboard/project/xssqhifnabymmsvvybgx/storage/buckets" target="_blank" class="url-link">
                üîó Open Supabase Storage
            </a></p>
            <div class="info">
                <ol>
                    <li>Click <strong>"New bucket"</strong></li>
                    <li>Name: <strong>papers</strong></li>
                    <li>Set to <strong>Private</strong></li>
                    <li>Click <strong>"Create bucket"</strong></li>
                </ol>
            </div>
        </div>

        <div class="step">
            <h2>üîë Step 3: Get API Keys</h2>
            <p>Get your Supabase API keys:</p>
            <p><a href="https://supabase.com/dashboard/project/xssqhifnabymmsvvybgx/settings/api" target="_blank" class="url-link">
                üîó Open API Settings
            </a></p>
            <div class="info">
                <p>Copy these values:</p>
                <ul>
                    <li><strong>Project URL:</strong> https://xssqhifnabymmsvvybgx.supabase.co ‚úÖ</li>
                    <li><strong>Anon/Public Key:</strong> eyJhbGciOiJIUzI1NiIsInR5cCI6... (copy from dashboard)</li>
                    <li><strong>Service Role Key:</strong> eyJhbGciOiJIUzI1NiIsInR5cCI6... (copy from dashboard)</li>
                </ul>
            </div>
        </div>

        <div class="step">
            <h2>üöÄ Step 4: Deploy to Vercel</h2>
            <p>Deploy your application:</p>
            <button class="button" onclick="window.open('https://vercel.com/new', '_blank')">üöÄ Deploy on Vercel</button>
            
            <div class="info">
                <h3>Environment Variables to Add in Vercel:</h3>
                <div class="sql-box">FLASK_CONFIG=vercel
SECRET_KEY=paper-cms-super-secret-key-2025-change-this
SUPABASE_URL=https://xssqhifnabymmsvvybgx.supabase.co
SUPABASE_ANON_KEY=your-anon-key-from-step-3
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key-from-step-3
DATABASE_URL=postgresql://postgres:Admin@123#Admin@db.xssqhifnabymmsvvybgx.supabase.co:5432/postgres
SUPABASE_STORAGE_BUCKET=papers
VERCEL=1</div>
            </div>
        </div>

        <div class="step">
            <h2>üéâ You're Done!</h2>
            <p class="success">Default login credentials:</p>
            <ul>
                <li><strong>Email:</strong> admin@paper-cms.com</li>
                <li><strong>Password:</strong> admin123</li>
            </ul>
            <p class="warning">‚ö†Ô∏è Change this password immediately after first login!</p>
        </div>
    </div>

    <script>
        function copySQL() {
            const sqlContent = document.getElementById('sqlContent');
            const textArea = document.createElement('textarea');
            textArea.value = sqlContent.textContent;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = '‚úÖ Copied!';
            button.style.background = '#38a169';
            
            setTimeout(() => {
                button.textContent = originalText;
                button.style.background = '#4299e1';
            }, 2000);
        }
    </script>
</body>
</html>